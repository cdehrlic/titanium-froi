<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Titanium Defense Group - Smart Claim Intake v3.0</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0}:root{--td:#1e2a38;--tn:#2d3a4a;--ts:#3d4f63;--ta:#5ba4e6;--tg:#34d399;--tw:#fbbf24;--tr:#f87171;--tt:#f1f5f9;--tm:#94a3b8;--gb:rgba(45,58,74,0.6);--gbd:rgba(148,163,184,0.12)}body{font-family:'DM Sans',sans-serif;background:var(--td);min-height:100vh;color:var(--tt)}.portal{position:relative;z-index:1}.header{background:linear-gradient(180deg,var(--tn) 0%,var(--td) 100%);border-bottom:1px solid var(--gbd);padding:16px 28px;position:sticky;top:0;z-index:100}.header-content{max-width:1280px;margin:0 auto;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:16px}.brand{display:flex;align-items:center;gap:14px}.brand-logo{width:44px;height:44px;background:var(--ts);border:2px solid var(--ts);border-radius:10px;display:flex;align-items:center;justify-content:center}.brand-logo svg{width:24px;height:24px;fill:white}.brand h1{font-family:'Space Grotesk',sans-serif;font-size:16px;color:white}.brand p{font-size:10px;color:var(--tm)}.completion{display:flex;align-items:center;gap:10px;background:var(--gb);padding:8px 14px;border-radius:10px;border:1px solid var(--gbd)}.completion-bar{width:80px;height:6px;background:rgba(30,42,56,0.8);border-radius:3px;overflow:hidden}.completion-fill{height:100%;background:var(--tg);border-radius:3px;transition:width 0.4s}.completion span{font-size:12px;font-weight:700;color:var(--tg)}.body{display:flex;max-width:1280px;margin:0 auto;padding:20px;gap:20px}.sidebar{width:200px;flex-shrink:0}.steps{background:var(--gb);border-radius:14px;border:1px solid var(--gbd);padding:10px}.step{display:flex;align-items:center;gap:8px;padding:10px 12px;border-radius:8px;cursor:pointer;transition:all 0.2s;margin-bottom:3px;border:1px solid transparent}.step:hover{background:rgba(91,164,230,0.08)}.step.active{background:rgba(91,164,230,0.12);border-color:rgba(91,164,230,0.3)}.step-icon{width:26px;height:26px;display:flex;align-items:center;justify-content:center;font-size:12px;background:var(--td);border-radius:6px}.step.active .step-icon{background:var(--ta)}.step span{font-size:12px;color:var(--tm)}.step.active span{color:var(--ta);font-weight:600}.main{flex:1;min-width:0}.content{background:var(--gb);border-radius:16px;border:1px solid var(--gbd);padding:24px}.section-header{margin-bottom:20px;padding-bottom:14px;border-bottom:1px solid var(--gbd)}.section-header h2{font-family:'Space Grotesk',sans-serif;font-size:20px;color:white;margin-bottom:4px}.section-header p{font-size:13px;color:var(--tm)}.form-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:14px}.form-group{display:flex;flex-direction:column;gap:5px}.form-group.full{grid-column:1/-1}.form-group label{font-size:11px;font-weight:600;color:var(--tm);text-transform:uppercase;letter-spacing:0.5px}.req{color:var(--tr)}.input{background:rgba(30,42,56,0.8);border:1px solid var(--gbd);border-radius:8px;padding:10px 12px;font-size:13px;color:var(--tt);font-family:'DM Sans',sans-serif;width:100%;transition:all 0.2s}.input:focus{outline:none;border-color:var(--ta);box-shadow:0 0 0 2px rgba(91,164,230,0.15)}textarea.input{min-height:100px;resize:vertical}.toggle-group{display:flex;gap:6px;flex-wrap:wrap}.toggle-btn{padding:8px 14px;border-radius:8px;border:1px solid var(--gbd);background:rgba(30,42,56,0.6);color:var(--tm);font-size:12px;font-weight:600;cursor:pointer;font-family:'DM Sans',sans-serif;transition:all 0.2s}.toggle-btn:hover{border-color:var(--ts)}.toggle-btn.active{background:rgba(91,164,230,0.15);border-color:var(--ta);color:var(--ta)}.toggle-btn.active.success{background:rgba(52,211,153,0.15);border-color:var(--tg);color:var(--tg)}.toggle-btn.active.warning{background:rgba(251,191,36,0.15);border-color:var(--tw);color:var(--tw)}.toggle-btn.active.danger{background:rgba(248,113,113,0.12);border-color:var(--tr);color:var(--tr)}.chip{padding:6px 10px;border-radius:6px;border:1px solid var(--gbd);background:rgba(30,42,56,0.5);color:var(--tm);font-size:11px;cursor:pointer;transition:all 0.2s}.chip.active{background:rgba(91,164,230,0.12);border-color:var(--ta);color:var(--ta)}.info-box{padding:12px;background:rgba(91,164,230,0.08);border-radius:10px;border-left:3px solid var(--ta);font-size:12px;color:var(--tt);margin:12px 0}.warning-box{background:rgba(251,191,36,0.08);border-left-color:var(--tw)}.option-card{background:rgba(30,42,56,0.5);border:1px solid var(--gbd);border-radius:10px;padding:16px;margin:10px 0;cursor:pointer;transition:all 0.2s}.option-card:hover{border-color:var(--ta)}.option-card.selected{border-color:var(--ta);background:rgba(91,164,230,0.08)}.option-card h4{color:var(--ta);font-size:13px;margin-bottom:3px}.option-card p{color:var(--tm);font-size:11px}.sig-section{background:rgba(30,42,56,0.5);border-radius:10px;padding:16px;margin-top:16px;border:1px solid var(--gbd)}.sig-section h3{color:var(--ta);font-size:13px;margin-bottom:12px}.sig-canvas-wrap{background:white;border-radius:6px;margin:10px 0;overflow:hidden}.sig-canvas{width:100%;height:100px;cursor:crosshair;touch-action:none;display:block}.sig-actions{display:flex;gap:6px;margin-top:6px}.checkbox-group{display:flex;align-items:flex-start;gap:8px;margin:10px 0}.checkbox-group input{margin-top:2px;width:16px;height:16px;accent-color:var(--ta)}.checkbox-group label{font-size:12px;color:var(--tt);line-height:1.4}.legal-text{font-size:10px;color:var(--tm);line-height:1.4;padding:10px;background:rgba(30,42,56,0.5);border-radius:6px;margin:10px 0}.audio-rec{background:rgba(30,42,56,0.5);border-radius:10px;padding:14px;margin:14px 0;border:1px solid var(--gbd)}.audio-rec h4{color:var(--ta);font-size:12px;margin-bottom:6px}.rec-btn{width:44px;height:44px;border-radius:50%;border:none;cursor:pointer;font-size:18px;background:var(--tr)}.rec-btn.recording{animation:pulse 1s infinite}@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}.link-badge{display:inline-flex;align-items:center;gap:5px;background:rgba(52,211,153,0.12);border:1px solid var(--tg);color:var(--tg);padding:6px 12px;border-radius:6px;font-size:11px;font-weight:600}.nav{display:flex;justify-content:space-between;margin-top:24px;padding-top:20px;border-top:1px solid var(--gbd)}.nav-btn{padding:12px 24px;border-radius:10px;font-size:13px;font-weight:700;cursor:pointer;font-family:'DM Sans',sans-serif;border:none;transition:all 0.2s}.nav-btn.secondary{background:transparent;border:1px solid var(--gbd);color:var(--tm)}.nav-btn.secondary:hover{border-color:var(--ts);color:var(--tt)}.nav-btn.primary{background:linear-gradient(135deg,var(--tg) 0%,#10b981 100%);color:white}.nav-btn.primary:hover{transform:translateY(-1px);box-shadow:0 4px 15px rgba(52,211,153,0.3)}.nav-btn:disabled{opacity:0.5;cursor:not-allowed;transform:none!important}.success-box{max-width:480px;margin:60px auto;text-align:center;padding:40px;background:var(--gb);border-radius:20px;border:1px solid var(--gbd)}.success-icon{width:70px;height:70px;background:rgba(52,211,153,0.15);border:2px solid var(--tg);border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 24px;font-size:36px}.ref-num{font-size:28px;font-family:'Space Grotesk',monospace;color:white;font-weight:700;margin:16px 0}@media(max-width:900px){.body{flex-direction:column}.sidebar{width:100%}.steps{display:flex;overflow-x:auto;gap:6px;padding:8px}.step{flex-shrink:0;margin-bottom:0}.form-grid{grid-template-columns:1fr}}
</style>
</head>
<body>
<div id="root"></div>
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script>
const e=React.createElement,{useState:S,useEffect:E,useRef:R}=React;
const ENTITIES_P=fetch('/api/entities').then(r=>r.json()).catch(()=>[]);
const INJURY_TYPES=[{v:'slip_trip_fall',l:'Slip/Trip/Fall',i:'‚ö†Ô∏è'},{v:'struck_by',l:'Struck By',i:'üí•'},{v:'strain_sprain',l:'Strain/Sprain',i:'üí™'},{v:'cut_laceration',l:'Cut/Laceration',i:'ü©π'},{v:'burn',l:'Burn',i:'üî•'},{v:'vehicle',l:'Vehicle',i:'üöó'},{v:'assault',l:'Assault',i:'üö®'},{v:'other',l:'Other',i:'üìã'}];
const BODY_PARTS=['Head','Neck','Shoulder-L','Shoulder-R','Upper Back','Lower Back','Hip-L','Hip-R','Knee-L','Knee-R','Ankle-L','Ankle-R','Wrist-L','Wrist-R','Multiple'];
const STATES=['AL','AK','AZ','AR','CA','CO','CT','DE','FL','GA','HI','ID','IL','IN','IA','KS','KY','LA','ME','MD','MA','MI','MN','MS','MO','MT','NE','NV','NH','NJ','NM','NY','NC','ND','OH','OK','OR','PA','RI','SC','SD','TN','TX','UT','VT','VA','WA','WV','WI','WY'];

function App(){
const[entities,setEntities]=S([]);
const[step,setStep]=S(0);
const[submitting,setSubmitting]=S(false);
const[result,setResult]=S(null);
const[d,setD]=S({firstName:'',lastName:'',phone:'',dateOfBirth:'',dateOfHire:'',ssn:'',occupation:'',entity:'',customEntity:'',dateOfInjury:'',timeOfInjury:'',dateReported:'',accidentDescription:'',injuryType:'',bodyParts:[],soughtMedicalTreatment:null,initialFacilityName:'',witness1Name:'',witness1Phone:'',hasVideo:null,losingTime:null,dateLastWorked:'',returnStatus:'',directCause:'',rootCauseSymptoms:[],correctiveActions:[],validityConcerns:null,fraudIndicators:[],thirdPartyInvolved:null,witnessOpt:null,witnessData:{},witnessLink:null,witnessSigned:false,claimantOpt:null,claimantData:{},claimantLink:null,claimantSigned:false,hipaaOpt:null,hipaaData:{},hipaaLink:null,hipaaSigned:false,submitterName:'',submitterEmail:''});
const[inlineStmts,setInlineStmts]=S([]);
const[score,setScore]=S(0);
const wCanvasRef=R(null),cCanvasRef=R(null),hCanvasRef=R(null);
const wCtxRef=R(null),cCtxRef=R(null),hCtxRef=R(null);
const isDrawingRef=R(false);
const mediaRecorderRef=R(null);
const audioChunksRef=R([]);
const[recording,setRecording]=S(null); // 'witness', 'claimant', or null
const[audioBlobs,setAudioBlobs]=S({}); // {witness: blob, claimant: blob}

E(()=>{ENTITIES_P.then(setEntities)},[]);
E(()=>{const req=['firstName','lastName','entity','dateOfInjury','accidentDescription','injuryType','submitterName','submitterEmail'];let s=0;req.forEach(f=>{if(d[f])s+=12});setScore(Math.min(100,Math.round(s)))},[d]);

const u=(f,v)=>setD(p=>({...p,[f]:v}));
const uNested=(parent,f,v)=>setD(p=>({...p,[parent]:{...p[parent],[f]:v}}));
const ta=(f,v)=>setD(p=>{const a=p[f]||[];return{...p,[f]:a.includes(v)?a.filter(x=>x!==v):[...a,v]}});

const steps=[{t:'Employee',i:'üë§'},{t:'Claim',i:'üìã'},{t:'Incident',i:'‚ö°'},{t:'Medical',i:'üè•'},{t:'Evidence',i:'üëÅÔ∏è'},{t:'Work Status',i:'üíº'},{t:'Root Cause',i:'üîç'},{t:'Flags',i:'üö©'},{t:'Witness',i:'üë•'},{t:'Claimant',i:'üìù'},{t:'HIPAA',i:'üîê'},{t:'Submit',i:'‚úÖ'}];

const initCanvas=(ref,ctxRef)=>{if(ref.current){const c=ref.current;const rect=c.getBoundingClientRect();c.width=rect.width;c.height=100;const ctx=c.getContext('2d');ctx.strokeStyle='#1a1f26';ctx.lineWidth=2;ctx.lineCap='round';ctxRef.current=ctx}};

const startDraw=(ev,ctxRef)=>{isDrawingRef.current=true;const rect=ev.target.getBoundingClientRect();const x=(ev.clientX||ev.touches?.[0]?.clientX||0)-rect.left;const y=(ev.clientY||ev.touches?.[0]?.clientY||0)-rect.top;ctxRef.current?.beginPath();ctxRef.current?.moveTo(x,y)};
const draw=(ev,ctxRef)=>{if(!isDrawingRef.current||!ctxRef.current)return;ev.preventDefault();const rect=ev.target.getBoundingClientRect();const x=(ev.clientX||ev.touches?.[0]?.clientX||0)-rect.left;const y=(ev.clientY||ev.touches?.[0]?.clientY||0)-rect.top;ctxRef.current.lineTo(x,y);ctxRef.current.stroke()};
const stopDraw=(canvasRef,dataKey)=>{if(isDrawingRef.current&&canvasRef.current){isDrawingRef.current=false;uNested(dataKey,'signature',canvasRef.current.toDataURL())}};
const clearSig=(canvasRef,ctxRef,dataKey)=>{if(ctxRef.current&&canvasRef.current){ctxRef.current.clearRect(0,0,canvasRef.current.width,canvasRef.current.height);uNested(dataKey,'signature',null)}};

const startRecording=async(type)=>{try{const stream=await navigator.mediaDevices.getUserMedia({audio:true});mediaRecorderRef.current=new MediaRecorder(stream);audioChunksRef.current=[];mediaRecorderRef.current.ondataavailable=ev=>audioChunksRef.current.push(ev.data);mediaRecorderRef.current.onstop=()=>{const blob=new Blob(audioChunksRef.current,{type:'audio/webm'});setAudioBlobs(prev=>({...prev,[type]:blob}));stream.getTracks().forEach(t=>t.stop())};mediaRecorderRef.current.start();setRecording(type)}catch(err){alert('Could not access microphone. Please check permissions.')}};
const stopRecording=()=>{if(mediaRecorderRef.current&&recording){mediaRecorderRef.current.stop();setRecording(null)}};
const clearAudio=(type)=>setAudioBlobs(prev=>{const n={...prev};delete n[type];return n});

const generateLink=async(type,name,email,phone)=>{const claimRef='FROI-'+Date.now().toString().slice(-8);try{const res=await fetch('/api/generate-link',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({claimRef,type,personName:name,email,phone})});const json=await res.json();if(json.success)return json.link}catch(e){console.error(e)}return null};

const submitInlineStmt=async(type,formData,sig,audioBlob)=>{const claimRef='FROI-'+Date.now().toString().slice(-8);try{const fd=new FormData();fd.append('formData',JSON.stringify({...formData,hasAudioRecording:!!audioBlob}));fd.append('signatureData',JSON.stringify({typedName:formData.typedName||formData.witnessName||formData.claimantName||formData.patientName,signatureImage:sig}));fd.append('statementType',type);fd.append('claimRef',claimRef);if(audioBlob)fd.append('files',audioBlob,'audio-statement-'+type+'.webm');const res=await fetch('/api/submit-inline-statement',{method:'POST',body:fd});const json=await res.json();if(json.success){setInlineStmts(prev=>[...prev,{type,pdf:json.pdf,filename:json.filename}]);return true}}catch(e){console.error(e)}return false};

const submit=async()=>{setSubmitting(true);try{const fd=new FormData();fd.append('formData',JSON.stringify(d));fd.append('inlineStatements',JSON.stringify(inlineStmts));const res=await fetch('/api/submit-claim',{method:'POST',body:fd});const json=await res.json();if(json.success)setResult(json);else alert('Error: '+(json.error||'Unknown'))}catch(e){alert('Error: '+e.message)}setSubmitting(false)};

if(result)return e('div',{className:'portal'},e('header',{className:'header'},e('div',{className:'header-content'},e('div',{className:'brand'},e('div',{className:'brand-logo'},e('svg',{viewBox:'0 0 40 44'},e('path',{d:'M20 0L0 10v14c0 11 8.5 18.5 20 20 11.5-1.5 20-9 20-20V10L20 0zm0 4l16 8v12c0 8.8-6.8 14.8-16 16-9.2-1.2-16-7.2-16-16V12l16-8z'}))),e('div',null,e('h1',null,'TITANIUM'),e('p',null,'DEFENSE GROUP'))))),e('div',{className:'success-box'},e('div',{className:'success-icon'},'‚úì'),e('h2',{style:{color:'var(--tg)',marginBottom:12}},'Claim Submitted!'),e('p',{style:{color:'var(--tm)'}},'Reference Number:'),e('div',{className:'ref-num'},result.referenceNumber),e('p',{style:{color:'var(--tm)',margin:'20px 0'}},'Confirmation sent to '+d.submitterEmail),inlineStmts.length>0&&e('p',{style:{color:'var(--tg)',fontSize:12}},'‚úì '+inlineStmts.length+' e-signed document(s) attached'),e('button',{className:'nav-btn primary',style:{marginTop:20},onClick:()=>location.reload()},'Submit Another')));

const inp=(f,p,t='text')=>e('input',{type:t,className:'input',value:d[f]||'',onChange:x=>u(f,x.target.value),placeholder:p});
const sel=(f,opts,p)=>e('select',{className:'input',value:d[f]||'',onChange:x=>u(f,x.target.value)},e('option',{value:''},p),...opts.map(o=>e('option',{key:o,value:o},o)));
const tog=(f,opts)=>e('div',{className:'toggle-group'},...opts.map(o=>e('button',{key:o.v,type:'button',className:'toggle-btn'+(d[f]===o.v?' active'+(o.c?' '+o.c:''):''),onClick:()=>u(f,o.v)},o.l)));

const renderStatementStep=(type,title,subtitle,canvasRef,ctxRef,dataKey,optKey,linkKey,signedKey)=>{
E(()=>{if(d[optKey]==='now')initCanvas(canvasRef,ctxRef)},[d[optKey]]);
const data=d[dataKey]||{};
const setData=(f,v)=>uNested(dataKey,f,v);

return e('div',{className:'content'},
e('div',{className:'section-header'},e('h2',null,title),e('p',null,subtitle)),
e('div',{className:'form-group full'},e('label',null,'How would you like to collect this?'),
e('div',{className:'option-card'+(d[optKey]==='now'?' selected':''),onClick:()=>u(optKey,'now')},e('h4',null,'‚úçÔ∏è Complete Now'),e('p',null,'Collect signature now - person is present')),
e('div',{className:'option-card'+(d[optKey]==='later'?' selected':''),onClick:()=>u(optKey,'later')},e('h4',null,'üìß Send Link Later'),e('p',null,'Generate secure link to send via email/text')),
e('div',{className:'option-card'+(d[optKey]==='skip'?' selected':''),onClick:()=>u(optKey,'skip')},e('h4',null,'‚è≠Ô∏è Skip'),e('p',null,'Skip for now - collect after submission'))),

d[optKey]==='now'&&e('div',{style:{marginTop:16}},
type==='witness'&&e('div',{className:'form-grid'},
e('div',{className:'form-group'},e('label',null,'Witness Name'),e('input',{className:'input',value:data.witnessName||'',onChange:x=>setData('witnessName',x.target.value),placeholder:'Full name'})),
e('div',{className:'form-group'},e('label',null,'Phone'),e('input',{className:'input',value:data.witnessPhone||'',onChange:x=>setData('witnessPhone',x.target.value),placeholder:'Phone'})),
e('div',{className:'form-group'},e('label',null,'Relationship'),e('input',{className:'input',value:data.relationship||'',onChange:x=>setData('relationship',x.target.value),placeholder:'Coworker, Supervisor...'})),
e('div',{className:'form-group full'},e('label',null,'Statement'),e('textarea',{className:'input',value:data.statement||'',onChange:x=>setData('statement',x.target.value),placeholder:'Describe what was witnessed...'}))),

type==='claimant'&&e('div',{className:'form-grid'},
e('div',{className:'form-group'},e('label',null,'Claimant Name'),e('input',{className:'input',value:data.claimantName||'',onChange:x=>setData('claimantName',x.target.value),placeholder:'Full name'})),
e('div',{className:'form-group'},e('label',null,'DOB'),e('input',{type:'date',className:'input',value:data.dateOfBirth||'',onChange:x=>setData('dateOfBirth',x.target.value)})),
e('div',{className:'form-group full'},e('label',null,'Incident Description'),e('textarea',{className:'input',value:data.incidentDescription||'',onChange:x=>setData('incidentDescription',x.target.value),placeholder:'Describe what happened...'})),
e('div',{className:'form-group'},e('label',null,'Body Parts Injured'),e('input',{className:'input',value:data.bodyPartsInjured||'',onChange:x=>setData('bodyPartsInjured',x.target.value),placeholder:'Lower back, knee...'})),
e('div',{className:'form-group'},e('label',null,'Current Symptoms'),e('input',{className:'input',value:data.currentSymptoms||'',onChange:x=>setData('currentSymptoms',x.target.value),placeholder:'Pain, swelling...'}))),

type==='hipaa'&&e('div',null,
e('div',{className:'form-grid'},
e('div',{className:'form-group'},e('label',null,'Patient Name'),e('input',{className:'input',value:data.patientName||'',onChange:x=>setData('patientName',x.target.value),placeholder:'Full legal name'})),
e('div',{className:'form-group'},e('label',null,'DOB'),e('input',{type:'date',className:'input',value:data.dateOfBirth||'',onChange:x=>setData('dateOfBirth',x.target.value)})),
e('div',{className:'form-group'},e('label',null,'Last 4 SSN'),e('input',{className:'input',maxLength:4,value:data.ssnLast4||'',onChange:x=>setData('ssnLast4',x.target.value.replace(/\D/g,'')),placeholder:'1234'})),
e('div',{className:'form-group'},e('label',null,'Employer'),e('input',{className:'input',value:data.employer||'',onChange:x=>setData('employer',x.target.value)}))),
e('div',{className:'legal-text'},e('strong',null,'HIPAA AUTHORIZATION'),e('p',null,'I authorize all healthcare providers to release my protected health information to Titanium Defense Group for processing my workers\' compensation claim. This authorization expires one year from signing or when the claim closes.'))),

type!=='hipaa'&&e('div',{className:'audio-rec'},
e('h4',null,'üé§ Record Audio Statement (Optional)'),
e('p',{style:{fontSize:11,color:'var(--tm)',marginBottom:10}},'Record a verbal statement in addition to or instead of written.'),
e('div',{style:{display:'flex',alignItems:'center',gap:12}},
e('button',{type:'button',className:'rec-btn'+(recording===type?' recording':''),onClick:()=>recording===type?stopRecording():startRecording(type)},recording===type?'‚èπ':'üé§'),
e('span',{style:{fontSize:12,color:recording===type?'var(--tr)':'var(--tm)'}},recording===type?'Recording... Click to stop':'Click to record')),
audioBlobs[type]&&e('div',{style:{marginTop:10}},
e('audio',{src:URL.createObjectURL(audioBlobs[type]),controls:true,style:{width:'100%',borderRadius:6}}),
e('button',{type:'button',className:'nav-btn secondary',style:{marginTop:6,padding:'6px 12px',fontSize:11},onClick:()=>clearAudio(type)},'Remove Recording'))),

e('div',{className:'sig-section'},e('h3',null,'‚úçÔ∏è Electronic Signature'),
e('div',{className:'sig-canvas-wrap'},e('canvas',{ref:canvasRef,className:'sig-canvas',onMouseDown:ev=>startDraw(ev,ctxRef),onMouseMove:ev=>draw(ev,ctxRef),onMouseUp:()=>stopDraw(canvasRef,dataKey),onMouseLeave:()=>stopDraw(canvasRef,dataKey),onTouchStart:ev=>startDraw(ev,ctxRef),onTouchMove:ev=>draw(ev,ctxRef),onTouchEnd:()=>stopDraw(canvasRef,dataKey)})),
e('div',{className:'sig-actions'},e('button',{className:'nav-btn secondary',type:'button',onClick:()=>clearSig(canvasRef,ctxRef,dataKey)},'Clear')),
e('div',{className:'form-group',style:{marginTop:12}},e('label',null,'Type Full Legal Name'),e('input',{className:'input',value:data.typedName||'',onChange:x=>setData('typedName',x.target.value),placeholder:'Full legal name'})),
e('div',{className:'checkbox-group'},e('input',{type:'checkbox',checked:data.consent1||false,onChange:x=>setData('consent1',x.target.checked)}),e('label',null,type==='hipaa'?'I authorize the release of my protected health information.':'I certify this information is true and correct.')),
e('div',{className:'checkbox-group'},e('input',{type:'checkbox',checked:data.consent2||false,onChange:x=>setData('consent2',x.target.checked)}),e('label',null,'I consent to sign electronically per the E-SIGN Act.')),
!d[signedKey]&&e('button',{className:'nav-btn primary',style:{marginTop:12},onClick:async()=>{if(!data.typedName){alert('Please type your name');return}if(!data.signature){alert('Please sign above');return}if(!data.consent1||!data.consent2){alert('Please check both boxes');return}const ok=await submitInlineStmt(type,data,data.signature,audioBlobs[type]);if(ok){u(signedKey,true);clearAudio(type);alert('‚úì Signed successfully!')}else alert('Error signing')}},d[signedKey]?'‚úì Signed':'Sign & Save'),
d[signedKey]&&e('div',{className:'link-badge',style:{marginTop:12}},'‚úì Signed and attached to claim'))),

d[optKey]==='later'&&e('div',{style:{marginTop:16}},
e('div',{className:'form-grid'},
e('div',{className:'form-group'},e('label',null,'Name'),e('input',{className:'input',value:data.linkName||'',onChange:x=>setData('linkName',x.target.value),placeholder:'Person\'s name'})),
e('div',{className:'form-group'},e('label',null,'Email'),e('input',{type:'email',className:'input',value:data.linkEmail||'',onChange:x=>setData('linkEmail',x.target.value),placeholder:'email@example.com'})),
e('div',{className:'form-group'},e('label',null,'Phone'),e('input',{className:'input',value:data.linkPhone||'',onChange:x=>setData('linkPhone',x.target.value),placeholder:'For SMS (optional)'}))),
!d[linkKey]&&e('button',{className:'nav-btn primary',style:{marginTop:12},onClick:async()=>{const link=await generateLink(type,data.linkName,data.linkEmail,data.linkPhone);if(link){u(linkKey,link);alert('‚úì Link generated and sent!')}else alert('Error generating link')}},'Generate & Send Link'),
d[linkKey]&&e('div',null,e('div',{className:'link-badge',style:{marginTop:12}},'‚úì Link sent'),e('p',{style:{fontSize:11,color:'var(--tm)',marginTop:8,wordBreak:'break-all'}},d[linkKey]))),

d[optKey]==='skip'&&e('div',{className:'info-box',style:{marginTop:16}},'This can be collected after the claim is submitted.'))};

const renderStep=()=>{
if(step===0)return e('div',{className:'content'},e('div',{className:'section-header'},e('h2',null,'Employee Information')),e('div',{className:'form-grid'},e('div',{className:'form-group'},e('label',null,'First Name ',e('span',{className:'req'},'*')),inp('firstName','First name')),e('div',{className:'form-group'},e('label',null,'Last Name ',e('span',{className:'req'},'*')),inp('lastName','Last name')),e('div',{className:'form-group'},e('label',null,'Phone'),inp('phone','Phone','tel')),e('div',{className:'form-group'},e('label',null,'DOB'),inp('dateOfBirth','','date')),e('div',{className:'form-group'},e('label',null,'Date of Hire'),inp('dateOfHire','','date')),e('div',{className:'form-group'},e('label',null,'SSN'),inp('ssn','XXX-XX-XXXX')),e('div',{className:'form-group full'},e('label',null,'Occupation'),inp('occupation','Job title'))));

if(step===1)return e('div',{className:'content'},e('div',{className:'section-header'},e('h2',null,'Claim Information')),e('div',{className:'form-group full'},e('label',null,'Entity ',e('span',{className:'req'},'*')),sel('entity',[...entities,'Other'],'Select entity'),d.entity==='Other'&&e('input',{className:'input',style:{marginTop:8},value:d.customEntity||'',onChange:x=>u('customEntity',x.target.value),placeholder:'Enter entity name'})),e('div',{className:'form-grid',style:{marginTop:14}},e('div',{className:'form-group'},e('label',null,'Date of Injury ',e('span',{className:'req'},'*')),inp('dateOfInjury','','date')),e('div',{className:'form-group'},e('label',null,'Time'),inp('timeOfInjury','','time')),e('div',{className:'form-group'},e('label',null,'Date Reported'),inp('dateReported','','date'))));

if(step===2)return e('div',{className:'content'},e('div',{className:'section-header'},e('h2',null,'Incident Details')),e('div',{className:'form-group full'},e('label',null,'Description ',e('span',{className:'req'},'*')),e('textarea',{className:'input',value:d.accidentDescription||'',onChange:x=>u('accidentDescription',x.target.value),placeholder:'What happened?'})),e('div',{className:'form-group full',style:{marginTop:14}},e('label',null,'Injury Type ',e('span',{className:'req'},'*')),e('div',{className:'toggle-group'},...INJURY_TYPES.map(t=>e('button',{key:t.v,type:'button',className:'toggle-btn'+(d.injuryType===t.v?' active':''),onClick:()=>u('injuryType',t.v)},t.i+' '+t.l)))),e('div',{className:'form-group full',style:{marginTop:14}},e('label',null,'Body Parts'),e('div',{style:{display:'flex',flexWrap:'wrap',gap:6}},...BODY_PARTS.map(p=>e('button',{key:p,type:'button',className:'chip'+(d.bodyParts?.includes(p)?' active':''),onClick:()=>ta('bodyParts',p)},p)))));

if(step===3)return e('div',{className:'content'},e('div',{className:'section-header'},e('h2',null,'Medical Treatment')),e('div',{className:'form-group'},e('label',null,'Has employee received medical treatment?'),tog('soughtMedicalTreatment',[{v:true,l:'Yes'},{v:false,l:'No'}])),d.soughtMedicalTreatment===true&&e('div',{className:'form-group',style:{marginTop:14}},e('label',null,'Facility Name'),inp('initialFacilityName','Hospital/Clinic name')));

if(step===4)return e('div',{className:'content'},e('div',{className:'section-header'},e('h2',null,'Witnesses & Evidence')),e('div',{className:'form-grid'},e('div',{className:'form-group'},e('label',null,'Witness Name'),inp('witness1Name','Name')),e('div',{className:'form-group'},e('label',null,'Witness Phone'),inp('witness1Phone','Phone'))),e('div',{className:'form-group',style:{marginTop:14}},e('label',null,'Video Available?'),tog('hasVideo',[{v:true,l:'Yes',c:'success'},{v:false,l:'No'}])),d.hasVideo===true&&e('div',{className:'info-box'},'‚ö° Preserve video immediately - systems auto-delete in 7-30 days'));

if(step===5)return e('div',{className:'content'},e('div',{className:'section-header'},e('h2',null,'Work Status')),e('div',{className:'form-grid'},e('div',{className:'form-group'},e('label',null,'Losing Time?'),tog('losingTime',[{v:true,l:'Yes',c:'warning'},{v:false,l:'No',c:'success'}])),e('div',{className:'form-group'},e('label',null,'Date Last Worked'),inp('dateLastWorked','','date')),e('div',{className:'form-group'},e('label',null,'Return Status'),sel('returnStatus',['Has not returned','Full Duty','Light Duty'],'Select'))));

if(step===6)return e('div',{className:'content'},e('div',{className:'section-header'},e('h2',null,'Root Cause Analysis')),e('div',{className:'form-group full'},e('label',null,'Direct Cause'),e('textarea',{className:'input',rows:2,value:d.directCause||'',onChange:x=>u('directCause',x.target.value),placeholder:'What directly caused the injury?'})));

if(step===7)return e('div',{className:'content'},e('div',{className:'section-header'},e('h2',null,'Investigation Flags')),e('div',{className:'warning-box info-box'},'‚ö†Ô∏è Red flags for closer review, not accusations.'),e('div',{className:'form-group'},e('label',null,'Validity Concerns?'),tog('validityConcerns',[{v:true,l:'Yes',c:'warning'},{v:false,l:'No'}])),e('div',{className:'form-group',style:{marginTop:14}},e('label',null,'Third Party Involved? (Subrogation)'),tog('thirdPartyInvolved',[{v:true,l:'Yes',c:'success'},{v:false,l:'No'},{v:'maybe',l:'Maybe'}])));

if(step===8)return renderStatementStep('witness','Witness Statement','Collect a signed witness statement',wCanvasRef,wCtxRef,'witnessData','witnessOpt','witnessLink','witnessSigned');
if(step===9)return renderStatementStep('claimant','Claimant Statement','Collect the injured worker\'s signed statement',cCanvasRef,cCtxRef,'claimantData','claimantOpt','claimantLink','claimantSigned');
if(step===10)return renderStatementStep('hipaa','HIPAA Authorization','Collect signed HIPAA release for medical records',hCanvasRef,hCtxRef,'hipaaData','hipaaOpt','hipaaLink','hipaaSigned');

if(step===11)return e('div',{className:'content'},e('div',{className:'section-header'},e('h2',null,'Submit Claim')),e('div',{style:{textAlign:'center',margin:'16px 0'}},e('div',{style:{display:'inline-block',width:70,height:70,borderRadius:'50%',background:'conic-gradient(var(--tg) '+score+'%, rgba(139,148,158,0.2) '+score+'%)',position:'relative'}},e('div',{style:{position:'absolute',top:6,left:6,width:58,height:58,background:'var(--td)',borderRadius:'50%',display:'flex',alignItems:'center',justifyContent:'center'}},e('span',{style:{fontSize:20,fontWeight:'bold',color:'var(--tg)'}},score+'%')))),inlineStmts.length>0&&e('div',{className:'info-box',style:{background:'rgba(52,211,153,0.1)',borderColor:'var(--tg)'}},'‚úì '+inlineStmts.length+' e-signed document(s) will be attached'),e('div',{className:'form-grid',style:{marginTop:20}},e('div',{className:'form-group'},e('label',null,'Your Name ',e('span',{className:'req'},'*')),inp('submitterName','Your name')),e('div',{className:'form-group'},e('label',null,'Your Email ',e('span',{className:'req'},'*')),inp('submitterEmail','email@company.com','email'))),e('div',{className:'legal-text',style:{marginTop:16,textAlign:'center'}},'THE ABOVE REPORT IS TRUE AND CORRECT.'));
};

return e('div',{className:'portal'},
e('header',{className:'header'},e('div',{className:'header-content'},e('div',{className:'brand'},e('div',{className:'brand-logo'},e('svg',{viewBox:'0 0 40 44'},e('path',{d:'M20 0L0 10v14c0 11 8.5 18.5 20 20 11.5-1.5 20-9 20-20V10L20 0zm0 4l16 8v12c0 8.8-6.8 14.8-16 16-9.2-1.2-16-7.2-16-16V12l16-8z'}))),e('div',null,e('h1',null,'TITANIUM'),e('p',null,'DEFENSE GROUP'))),e('div',{className:'completion'},e('div',{className:'completion-bar'},e('div',{className:'completion-fill',style:{width:score+'%'}})),e('span',null,score+'%')))),
e('div',{className:'body'},
e('aside',{className:'sidebar'},e('div',{className:'steps'},...steps.map((s,i)=>e('div',{key:i,className:'step'+(i===step?' active':''),onClick:()=>setStep(i)},e('div',{className:'step-icon'},s.i),e('span',null,s.t))))),
e('main',{className:'main'},renderStep(),e('div',{className:'nav'},e('button',{className:'nav-btn secondary',onClick:()=>setStep(Math.max(0,step-1)),disabled:step===0},'‚Üê Back'),step<11?e('button',{className:'nav-btn primary',onClick:()=>setStep(step+1)},'Continue ‚Üí'):e('button',{className:'nav-btn primary',disabled:submitting,onClick:submit},submitting?'Submitting...':'Submit Claim')))));
}

ReactDOM.createRoot(document.getElementById('root')).render(e(App));
</script>
</body>
</html>

