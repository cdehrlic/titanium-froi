<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Titanium Defense Group - Smart Claim Intake</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0}:root{--td:#1e2a38;--tn:#2d3a4a;--ts:#3d4f63;--tl:#4a6178;--ta:#5ba4e6;--ta2:#7eb8f0;--tg:#34d399;--tw:#fbbf24;--tr:#f87171;--tt:#f1f5f9;--tm:#94a3b8;--tb:rgba(148,163,184,0.15);--gb:rgba(45,58,74,0.6);--gbd:rgba(148,163,184,0.12)}body{font-family:'DM Sans',sans-serif;background:var(--td);min-height:100vh;color:var(--tt)}body::before{content:'';position:fixed;inset:0;background:radial-gradient(ellipse at top,rgba(91,164,230,0.08) 0%,transparent 50%);pointer-events:none;z-index:0}.portal{position:relative;z-index:1}.header{background:linear-gradient(180deg,var(--tn) 0%,var(--td) 100%);border-bottom:1px solid var(--gbd);padding:16px 28px;position:sticky;top:0;z-index:100}.header-content{max-width:1280px;margin:0 auto;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:16px}.brand{display:flex;align-items:center;gap:14px}.brand-logo{width:48px;height:48px;background:var(--ts);border:2px solid var(--tl);border-radius:12px;display:flex;align-items:center;justify-content:center}.brand-logo svg{width:28px;height:28px;fill:white}.brand-text h1{font-family:'Space Grotesk',sans-serif;font-size:18px;color:white}.brand-text p{font-size:11px;color:var(--tm)}.completion-badge{display:flex;align-items:center;gap:12px;background:var(--gb);padding:10px 18px;border-radius:12px;border:1px solid var(--gbd)}.completion-bar{width:100px;height:8px;background:rgba(30,42,56,0.8);border-radius:4px;overflow:hidden}.completion-fill{height:100%;background:linear-gradient(90deg,var(--tg) 0%,#10b981 100%);border-radius:4px;transition:width 0.5s}.completion-text{font-size:13px;font-weight:700;color:var(--tg)}.body{display:flex;max-width:1280px;margin:0 auto;padding:24px;gap:24px}.sidebar{width:220px;flex-shrink:0}.steps{background:var(--gb);border-radius:16px;border:1px solid var(--gbd);padding:12px}.step{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:10px;cursor:pointer;transition:all 0.2s;margin-bottom:4px;border:1px solid transparent}.step:hover{background:rgba(91,164,230,0.08)}.step.active{background:linear-gradient(135deg,rgba(91,164,230,0.15) 0%,rgba(91,164,230,0.08) 100%);border-color:rgba(91,164,230,0.3)}.step-icon{width:26px;height:26px;display:flex;align-items:center;justify-content:center;font-size:12px;background:var(--td);border-radius:8px}.step.active .step-icon{background:var(--ta);color:white}.step span{font-size:12px;color:var(--tm)}.step.active span{color:var(--ta2);font-weight:600}.main{flex:1;min-width:0}.content{background:var(--gb);border-radius:20px;border:1px solid var(--gbd);padding:28px}.section-header{margin-bottom:24px;padding-bottom:16px;border-bottom:1px solid var(--gbd)}.section-header h2{font-family:'Space Grotesk',sans-serif;font-size:22px;color:white;margin-bottom:6px}.section-subtitle{font-size:14px;color:var(--tm)}.form-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:16px}.form-group{display:flex;flex-direction:column;gap:6px}.form-group.full-width{grid-column:1/-1}.form-group label{font-size:12px;font-weight:600;color:var(--tm);text-transform:uppercase;letter-spacing:0.5px}.required{color:var(--tr)}.input-field{background:rgba(30,42,56,0.8);border:1px solid var(--tb);border-radius:10px;padding:12px 14px;font-size:14px;color:var(--tt);font-family:'DM Sans',sans-serif;width:100%;transition:all 0.2s}.input-field:focus{outline:none;border-color:var(--ta);box-shadow:0 0 0 3px rgba(91,164,230,0.15)}.toggle-group{display:flex;gap:8px;flex-wrap:wrap}.toggle-btn{padding:10px 18px;border-radius:10px;border:1px solid var(--tb);background:rgba(30,42,56,0.6);color:var(--tm);font-size:13px;font-weight:600;cursor:pointer;font-family:'DM Sans',sans-serif;transition:all 0.2s}.toggle-btn:hover{border-color:var(--tl)}.toggle-btn.active{background:linear-gradient(135deg,rgba(91,164,230,0.2) 0%,rgba(91,164,230,0.1) 100%);border-color:var(--ta);color:var(--ta2)}.toggle-btn.active.success{background:linear-gradient(135deg,rgba(52,211,153,0.2) 0%,rgba(52,211,153,0.1) 100%);border-color:var(--tg);color:var(--tg)}.toggle-btn.active.warning{background:linear-gradient(135deg,rgba(251,191,36,0.2) 0%,rgba(251,191,36,0.1) 100%);border-color:var(--tw);color:var(--tw)}.toggle-btn.active.danger{background:linear-gradient(135deg,rgba(248,113,113,0.15) 0%,rgba(248,113,113,0.08) 100%);border-color:var(--tr);color:var(--tr)}.injury-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:10px}.injury-btn{display:flex;flex-direction:column;align-items:center;gap:6px;padding:12px 8px;border-radius:12px;border:1px solid var(--tb);background:rgba(30,42,56,0.5);cursor:pointer;font-family:'DM Sans',sans-serif;transition:all 0.2s}.injury-btn:hover{border-color:var(--tl)}.injury-btn.active{background:linear-gradient(135deg,rgba(91,164,230,0.15) 0%,rgba(91,164,230,0.08) 100%);border-color:var(--ta)}.injury-icon{font-size:22px}.injury-label{font-size:10px;color:var(--tm);text-align:center}.injury-btn.active .injury-label{color:var(--ta2)}.chip-btn{padding:8px 12px;border-radius:8px;border:1px solid var(--tb);background:rgba(30,42,56,0.5);color:var(--tm);font-size:12px;cursor:pointer;font-family:'DM Sans',sans-serif;transition:all 0.2s}.chip-btn:hover{border-color:var(--tl)}.chip-btn.active{background:linear-gradient(135deg,rgba(91,164,230,0.15) 0%,rgba(91,164,230,0.08) 100%);border-color:var(--ta);color:var(--ta2)}.chip-btn.active.warning{border-color:var(--tw);color:var(--tw)}.chip-btn.active.success{border-color:var(--tg);color:var(--tg)}.chip-btn.active.danger{border-color:var(--tr);color:var(--tr)}.info-tip{padding:14px 16px;background:linear-gradient(135deg,rgba(91,164,230,0.1) 0%,rgba(91,164,230,0.05) 100%);border-radius:12px;border-left:3px solid var(--ta);margin:12px 0;font-size:13px}.warning-box{background:linear-gradient(135deg,rgba(251,191,36,0.12) 0%,rgba(251,191,36,0.06) 100%);border:1px solid rgba(251,191,36,0.3);border-radius:12px;padding:16px;font-size:14px;color:var(--tw);margin-bottom:18px}.witness-card{background:rgba(30,42,56,0.5);border:1px solid var(--tb);border-radius:12px;padding:16px;margin-top:14px}.witness-header{font-size:13px;font-weight:700;color:var(--ta);margin-bottom:12px;text-transform:uppercase}.option-card{background:rgba(30,42,56,0.5);border:1px solid var(--gbd);border-radius:12px;padding:18px;margin:10px 0;cursor:pointer;transition:all 0.2s}.option-card:hover{border-color:var(--ta)}.option-card.selected{border-color:var(--ta);background:linear-gradient(135deg,rgba(91,164,230,0.1) 0%,rgba(91,164,230,0.05) 100%)}.option-card h4{color:var(--ta);font-size:14px;margin-bottom:4px}.option-card p{color:var(--tm);font-size:12px}.sig-section{background:rgba(30,42,56,0.5);border-radius:12px;padding:20px;margin-top:20px;border:1px solid var(--gbd)}.sig-section h3{color:var(--ta);font-size:14px;margin-bottom:16px}.sig-canvas-wrap{background:white;border-radius:8px;margin:12px 0;overflow:hidden}.sig-canvas{width:100%;height:120px;cursor:crosshair;touch-action:none;display:block}.checkbox-group{display:flex;align-items:flex-start;gap:10px;margin:12px 0}.checkbox-group input{margin-top:3px;width:18px;height:18px;accent-color:var(--ta);flex-shrink:0}.checkbox-group label{font-size:13px;color:var(--tt);line-height:1.4}.legal-text{font-size:11px;color:var(--tm);line-height:1.5;padding:12px;background:rgba(30,42,56,0.5);border-radius:8px;margin:12px 0}.audio-rec{background:rgba(30,42,56,0.5);border-radius:12px;padding:16px;margin:16px 0;border:1px solid var(--gbd)}.audio-rec h4{color:var(--ta);font-size:13px;margin-bottom:8px}.rec-btn{width:50px;height:50px;border-radius:50%;border:none;cursor:pointer;font-size:20px;background:var(--tr);display:flex;align-items:center;justify-content:center}.rec-btn.recording{animation:pulse 1s infinite}@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}.link-badge{display:inline-flex;align-items:center;gap:6px;background:rgba(52,211,153,0.15);border:1px solid var(--tg);color:var(--tg);padding:8px 14px;border-radius:8px;font-size:12px;font-weight:600}.nav{display:flex;justify-content:space-between;margin-top:28px;padding-top:24px;border-top:1px solid var(--gbd)}.nav-btn{padding:14px 28px;border-radius:12px;font-size:14px;font-weight:700;cursor:pointer;font-family:'DM Sans',sans-serif;border:none;transition:all 0.2s}.nav-btn.secondary{background:transparent;border:1px solid var(--tb);color:var(--tm)}.nav-btn.secondary:hover{border-color:var(--tl);color:var(--tt)}.nav-btn.primary{background:linear-gradient(135deg,var(--tg) 0%,#10b981 100%);color:white}.nav-btn.primary:hover{transform:translateY(-2px);box-shadow:0 6px 25px rgba(52,211,153,0.4)}.nav-btn:disabled{opacity:0.5;cursor:not-allowed;transform:none!important}.summary-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:14px;margin:20px 0}.summary-section{background:rgba(30,42,56,0.6);border-radius:12px;padding:18px;border:1px solid var(--gbd)}.summary-section h4{font-size:11px;color:var(--ta);margin-bottom:10px;text-transform:uppercase}.summary-section p{font-size:14px;color:var(--tt);margin-bottom:4px}.success-container{max-width:520px;margin:80px auto;text-align:center;padding:48px;background:var(--gb);border-radius:24px;border:1px solid var(--gbd)}.success-icon{width:88px;height:88px;background:linear-gradient(135deg,rgba(52,211,153,0.2) 0%,rgba(52,211,153,0.1) 100%);border:2px solid var(--tg);border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 28px;font-size:44px}.ref-number{font-size:36px;font-family:'Space Grotesk',monospace;color:white;font-weight:700;margin:20px 0}@media(max-width:900px){.body{flex-direction:column}.sidebar{width:100%}.steps{display:flex;overflow-x:auto;gap:8px;padding:10px}.step{flex-shrink:0;margin-bottom:0}.form-grid,.summary-grid{grid-template-columns:1fr}}
</style>
</head>
<body>
<div id="root"></div>
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script>
const e=React.createElement,{useState:S,useEffect:E,useRef:R}=React;
const INJURY_TYPES=[{v:'slip_trip_fall',l:'Slip/Trip/Fall',i:'‚ö†Ô∏è'},{v:'struck_by',l:'Struck By',i:'üí•'},{v:'strain_sprain',l:'Strain/Sprain',i:'üí™'},{v:'cut_laceration',l:'Cut/Laceration',i:'ü©π'},{v:'burn',l:'Burn',i:'üî•'},{v:'caught_in',l:'Caught In',i:'‚öôÔ∏è'},{v:'vehicle',l:'Vehicle',i:'üöó'},{v:'assault',l:'Assault',i:'üö®'},{v:'exposure',l:'Exposure',i:'‚ò£Ô∏è'},{v:'repetitive',l:'Repetitive',i:'üîÑ'},{v:'other',l:'Other',i:'üìã'}];
const BODY_PARTS=['Head','Face','Neck','Shoulder-L','Shoulder-R','Upper Back','Lower Back','Hip-L','Hip-R','Wrist-L','Wrist-R','Hand-L','Hand-R','Knee-L','Knee-R','Ankle-L','Ankle-R','Multiple'];
const ROOT_CAUSES=[{v:'no_training',l:'No Training'},{v:'inadequate_training',l:'Inadequate Training'},{v:'training_not_followed',l:'Training Not Followed'},{v:'no_supervision',l:'Lack of Supervision'},{v:'equipment_failure',l:'Equipment Failure'},{v:'no_ppe',l:'No PPE'},{v:'ppe_not_worn',l:'PPE Not Worn'},{v:'rushing',l:'Rushing'},{v:'fatigue',l:'Fatigue'},{v:'poor_housekeeping',l:'Poor Housekeeping'},{v:'wet_floor',l:'Wet Floor'},{v:'combative_patient',l:'Combative Patient'}];
const CORRECTIVE=[{v:'reviewed_procedures',l:'Reviewed Procedures'},{v:'training_scheduled',l:'Training Scheduled'},{v:'training_completed',l:'Training Completed'},{v:'discipline_verbal',l:'Verbal Warning'},{v:'discipline_written',l:'Written Warning'},{v:'equipment_repaired',l:'Equipment Repaired'},{v:'ppe_provided',l:'PPE Provided'},{v:'area_cleaned',l:'Area Cleaned'},{v:'safety_meeting',l:'Safety Meeting'}];
const FRAUD=[{v:'delayed_report',l:'Delayed Reporting'},{v:'monday_claim',l:'Monday Claim'},{v:'no_witnesses',l:'No Witnesses'},{v:'vague_description',l:'Vague Description'},{v:'recent_discipline',l:'Recent Discipline'},{v:'new_employee',l:'New Employee'},{v:'history_claims',l:'History of Claims'},{v:'attorney_immediate',l:'Attorney Immediately'},{v:'preexisting',l:'Pre-existing'}];
const STATES=['AL','AK','AZ','AR','CA','CO','CT','DE','FL','GA','HI','ID','IL','IN','IA','KS','KY','LA','ME','MD','MA','MI','MN','MS','MO','MT','NE','NV','NH','NJ','NM','NY','NC','ND','OH','OK','OR','PA','RI','SC','SD','TN','TX','UT','VT','VA','WA','WV','WI','WY'];

function App(){
const[entities,setEntities]=S([]);const[step,setStep]=S(0);const[submitting,setSubmitting]=S(false);const[result,setResult]=S(null);
const[d,setD]=S({firstName:'',lastName:'',mailingAddress:'',city:'',state:'',zipCode:'',phone:'',dateOfBirth:'',dateOfHire:'',ssn:'',occupation:'',entity:'',customEntity:'',dateOfInjury:'',timeOfInjury:'',dateReported:'',reportedImmediately:null,accidentDescription:'',injuryType:'',bodyParts:[],soughtMedicalTreatment:null,initialFacilityName:'',witness1Name:'',witness1Phone:'',witness2Name:'',witness2Phone:'',hasVideo:null,hasWitnessStatement:null,hasEmployeeStatement:null,losingTime:null,dateLastWorked:'',returnStatus:'',lightDutyAvailable:null,directCause:'',rootCauseSymptoms:[],correctiveActions:[],validityConcerns:null,concernDetails:'',fraudIndicators:[],thirdPartyInvolved:null,thirdPartyDetails:'',witnessOpt:null,witnessData:{},witnessLink:null,witnessSigned:false,claimantOpt:null,claimantData:{},claimantLink:null,claimantSigned:false,hipaaOpt:null,hipaaData:{},hipaaLink:null,hipaaSigned:false,submitterName:'',submitterEmail:''});
const[uploadedFiles,setUploadedFiles]=S([]);const[inlineStmts,setInlineStmts]=S([]);const[score,setScore]=S(0);const[lastSaved,setLastSaved]=S(null);const[recording,setRecording]=S(null);const[audioBlobs,setAudioBlobs]=S({});
const wCanvasRef=R(null),cCanvasRef=R(null),hCanvasRef=R(null);const wCtxRef=R(null),cCtxRef=R(null),hCtxRef=R(null);const isDrawingRef=R(false);const mediaRecorderRef=R(null);const audioChunksRef=R([]);

E(()=>{fetch('/api/entities').then(r=>r.json()).then(setEntities).catch(()=>{})},[]);
E(()=>{const req=['firstName','lastName','entity','dateOfInjury','accidentDescription','injuryType','submitterName','submitterEmail'];let s=0;req.forEach(f=>{if(d[f])s+=10});setScore(Math.min(100,Math.round(s)))},[d]);
E(()=>{try{localStorage.setItem('wcr_draft',JSON.stringify({data:d,savedAt:Date.now()}));setLastSaved(new Date().toLocaleTimeString())}catch(x){}},[d]);

const u=(f,v)=>setD(p=>({...p,[f]:v}));
const uNested=(parent,f,v)=>setD(p=>({...p,[parent]:{...p[parent],[f]:v}}));
const ta=(f,v)=>setD(p=>{const a=p[f]||[];return{...p,[f]:a.includes(v)?a.filter(x=>x!==v):[...a,v]}});

const steps=[{t:'Employee',i:'üë§'},{t:'Claim',i:'üìã'},{t:'Incident',i:'‚ö°'},{t:'Medical',i:'üè•'},{t:'Evidence',i:'üëÅÔ∏è'},{t:'Work Status',i:'üíº'},{t:'Root Cause',i:'üîç'},{t:'Flags',i:'üö©'},{t:'Witness Stmt',i:'üë•'},{t:'Claimant Stmt',i:'üìù'},{t:'HIPAA',i:'üîê'},{t:'Submit',i:'‚úÖ'}];

const initCanvas=(ref,ctxRef)=>{if(ref.current){const c=ref.current,rect=c.getBoundingClientRect();c.width=rect.width;c.height=120;const ctx=c.getContext('2d');ctx.strokeStyle='#1a1f26';ctx.lineWidth=2;ctx.lineCap='round';ctxRef.current=ctx}};
const startDraw=(ev,ctxRef)=>{ev.preventDefault();isDrawingRef.current=true;const rect=ev.target.getBoundingClientRect(),x=(ev.clientX||ev.touches?.[0]?.clientX||0)-rect.left,y=(ev.clientY||ev.touches?.[0]?.clientY||0)-rect.top;ctxRef.current?.beginPath();ctxRef.current?.moveTo(x,y)};
const draw=(ev,ctxRef)=>{if(!isDrawingRef.current||!ctxRef.current)return;ev.preventDefault();const rect=ev.target.getBoundingClientRect(),x=(ev.clientX||ev.touches?.[0]?.clientX||0)-rect.left,y=(ev.clientY||ev.touches?.[0]?.clientY||0)-rect.top;ctxRef.current.lineTo(x,y);ctxRef.current.stroke()};
const stopDraw=(canvasRef,dataKey)=>{if(isDrawingRef.current&&canvasRef.current){isDrawingRef.current=false;uNested(dataKey,'signature',canvasRef.current.toDataURL())}};
const clearSig=(canvasRef,ctxRef,dataKey)=>{if(ctxRef.current&&canvasRef.current){ctxRef.current.clearRect(0,0,canvasRef.current.width,canvasRef.current.height);uNested(dataKey,'signature',null)}};

const startRecording=async(type)=>{try{const stream=await navigator.mediaDevices.getUserMedia({audio:true});mediaRecorderRef.current=new MediaRecorder(stream);audioChunksRef.current=[];mediaRecorderRef.current.ondataavailable=ev=>audioChunksRef.current.push(ev.data);mediaRecorderRef.current.onstop=()=>{const blob=new Blob(audioChunksRef.current,{type:'audio/webm'});setAudioBlobs(prev=>({...prev,[type]:blob}));stream.getTracks().forEach(t=>t.stop())};mediaRecorderRef.current.start();setRecording(type)}catch(err){alert('Could not access microphone')}};
const stopRecording=()=>{if(mediaRecorderRef.current&&recording){mediaRecorderRef.current.stop();setRecording(null)}};
const clearAudio=(type)=>setAudioBlobs(prev=>{const n={...prev};delete n[type];return n});

const generateLink=async(type,name,email,phone)=>{const claimRef='FROI-'+Date.now().toString().slice(-8);try{const res=await fetch('/api/generate-link',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({claimRef,type,personName:name,email,phone})});const json=await res.json();if(json.success)return json.link}catch(x){console.error(x)}return null};

const submitInlineStmt=async(type,formData,sig,audioBlob)=>{const claimRef='FROI-'+Date.now().toString().slice(-8);try{const fd=new FormData();fd.append('formData',JSON.stringify({...formData,hasAudioRecording:!!audioBlob}));fd.append('signatureData',JSON.stringify({typedName:formData.typedName||formData.witnessName||formData.claimantName||formData.patientName,signatureImage:sig}));fd.append('statementType',type);fd.append('claimRef',claimRef);if(audioBlob)fd.append('files',audioBlob,'audio-'+type+'.webm');const res=await fetch('/api/submit-inline-statement',{method:'POST',body:fd});const json=await res.json();if(json.success){setInlineStmts(prev=>[...prev,{type,pdf:json.pdf,filename:json.filename}]);return true}}catch(x){console.error(x)}return false};

const submit=async()=>{setSubmitting(true);try{const fd=new FormData();fd.append('formData',JSON.stringify(d));fd.append('inlineStatements',JSON.stringify(inlineStmts));uploadedFiles.forEach(f=>fd.append('files',f));const res=await fetch('/api/submit-claim',{method:'POST',body:fd});const json=await res.json();if(json.success){localStorage.removeItem('wcr_draft');setResult(json)}else alert('Error: '+(json.error||'Unknown'))}catch(x){alert('Error: '+x.message)}setSubmitting(false)};

if(result)return e('div',{className:'portal'},e('header',{className:'header'},e('div',{className:'header-content'},e('div',{className:'brand'},e('div',{className:'brand-logo'},e('svg',{viewBox:'0 0 40 44'},e('path',{d:'M20 0L0 10v14c0 11 8.5 18.5 20 20 11.5-1.5 20-9 20-20V10L20 0zm0 4l16 8v12c0 8.8-6.8 14.8-16 16-9.2-1.2-16-7.2-16-16V12l16-8z'}))),e('div',{className:'brand-text'},e('h1',null,'TITANIUM'),e('p',null,'DEFENSE GROUP'))))),e('div',{className:'success-container'},e('div',{className:'success-icon'},'‚úì'),e('h2',{style:{color:'var(--tg)',marginBottom:16}},'Claim Submitted!'),e('p',{style:{color:'var(--tm)'}},'Reference Number:'),e('div',{className:'ref-number'},result.referenceNumber),e('p',{style:{color:'var(--tm)',margin:'20px 0'}},'Confirmation sent to '+d.submitterEmail),inlineStmts.length>0&&e('p',{style:{color:'var(--tg)',fontSize:13}},'‚úì '+inlineStmts.length+' e-signed document(s) attached'),e('button',{className:'nav-btn primary',style:{marginTop:20},onClick:()=>location.reload()},'Submit Another')));

const inp=(f,p,t='text')=>e('input',{type:t,className:'input-field',value:d[f]||'',onChange:x=>u(f,x.target.value),placeholder:p});
const sel=(f,opts,p)=>e('select',{className:'input-field',value:d[f]||'',onChange:x=>u(f,x.target.value)},e('option',{value:''},p),...opts.map(o=>e('option',{key:o,value:o},o)));
const tog=(f,opts)=>e('div',{className:'toggle-group'},...opts.map(o=>e('button',{key:o.v,type:'button',className:'toggle-btn'+(d[f]===o.v?' active'+(o.c?' '+o.c:''):''),onClick:()=>u(f,o.v)},o.l)));

const renderStatementStep=(type,title,subtitle,canvasRef,ctxRef,dataKey,optKey,linkKey,signedKey)=>{
const data=d[dataKey]||{};const setData=(f,v)=>uNested(dataKey,f,v);
E(()=>{if(d[optKey]==='now')setTimeout(()=>initCanvas(canvasRef,ctxRef),100)},[d[optKey]]);
return e('div',{className:'content'},e('div',{className:'section-header'},e('h2',null,title),e('p',{className:'section-subtitle'},subtitle)),
e('div',{className:'form-group full-width'},e('label',null,'How would you like to collect this?'),
e('div',{className:'option-card'+(d[optKey]==='now'?' selected':''),onClick:()=>u(optKey,'now')},e('h4',null,'‚úçÔ∏è Complete Now'),e('p',null,'Person is present - collect signature now')),
e('div',{className:'option-card'+(d[optKey]==='later'?' selected':''),onClick:()=>u(optKey,'later')},e('h4',null,'üìß Send Link Later'),e('p',null,'Generate secure link to send via email')),
e('div',{className:'option-card'+(d[optKey]==='skip'?' selected':''),onClick:()=>u(optKey,'skip')},e('h4',null,'‚è≠Ô∏è Skip'),e('p',null,'Collect after claim submission'))),
d[optKey]==='now'&&e('div',{style:{marginTop:20}},
type==='witness'&&e('div',{className:'form-grid'},e('div',{className:'form-group'},e('label',null,'Witness Name'),e('input',{className:'input-field',value:data.witnessName||'',onChange:x=>setData('witnessName',x.target.value),placeholder:'Full name'})),e('div',{className:'form-group'},e('label',null,'Phone'),e('input',{className:'input-field',value:data.witnessPhone||'',onChange:x=>setData('witnessPhone',x.target.value)})),e('div',{className:'form-group'},e('label',null,'Relationship'),e('input',{className:'input-field',value:data.relationship||'',onChange:x=>setData('relationship',x.target.value),placeholder:'Coworker, Supervisor...'})),e('div',{className:'form-group full-width'},e('label',null,'Statement'),e('textarea',{className:'input-field',rows:4,value:data.statement||'',onChange:x=>setData('statement',x.target.value),placeholder:'Describe what was witnessed...'}))),
type==='claimant'&&e('div',{className:'form-grid'},e('div',{className:'form-group'},e('label',null,'Claimant Name'),e('input',{className:'input-field',value:data.claimantName||'',onChange:x=>setData('claimantName',x.target.value),placeholder:'Full name'})),e('div',{className:'form-group'},e('label',null,'DOB'),e('input',{type:'date',className:'input-field',value:data.dateOfBirth||'',onChange:x=>setData('dateOfBirth',x.target.value)})),e('div',{className:'form-group full-width'},e('label',null,'Incident Description'),e('textarea',{className:'input-field',rows:4,value:data.incidentDescription||'',onChange:x=>setData('incidentDescription',x.target.value),placeholder:'Describe what happened...'})),e('div',{className:'form-group'},e('label',null,'Body Parts Injured'),e('input',{className:'input-field',value:data.bodyPartsInjured||'',onChange:x=>setData('bodyPartsInjured',x.target.value)})),e('div',{className:'form-group'},e('label',null,'Current Symptoms'),e('input',{className:'input-field',value:data.currentSymptoms||'',onChange:x=>setData('currentSymptoms',x.target.value)}))),
type==='hipaa'&&e('div',null,e('div',{className:'form-grid'},e('div',{className:'form-group'},e('label',null,'Patient Name'),e('input',{className:'input-field',value:data.patientName||'',onChange:x=>setData('patientName',x.target.value),placeholder:'Full legal name'})),e('div',{className:'form-group'},e('label',null,'DOB'),e('input',{type:'date',className:'input-field',value:data.dateOfBirth||'',onChange:x=>setData('dateOfBirth',x.target.value)})),e('div',{className:'form-group'},e('label',null,'Last 4 SSN'),e('input',{className:'input-field',maxLength:4,value:data.ssnLast4||'',onChange:x=>setData('ssnLast4',x.target.value.replace(/\D/g,''))})),e('div',{className:'form-group'},e('label',null,'Employer'),e('input',{className:'input-field',value:data.employer||'',onChange:x=>setData('employer',x.target.value)}))),e('div',{className:'legal-text'},e('strong',null,'HIPAA AUTHORIZATION'),e('p',{style:{marginTop:8}},'I authorize all healthcare providers to release my protected health information to Titanium Defense Group for processing my workers\' compensation claim.'))),
type!=='hipaa'&&e('div',{className:'audio-rec'},e('h4',null,'üé§ Record Audio Statement (Optional)'),e('p',{style:{fontSize:11,color:'var(--tm)',marginBottom:10}},'Record instead of or in addition to writing'),e('div',{style:{display:'flex',alignItems:'center',gap:12}},e('button',{type:'button',className:'rec-btn'+(recording===type?' recording':''),onClick:()=>recording===type?stopRecording():startRecording(type)},recording===type?'‚èπ':'üé§'),e('span',{style:{fontSize:12,color:recording===type?'var(--tr)':'var(--tm)'}},recording===type?'Recording...':'Click to record')),audioBlobs[type]&&e('div',{style:{marginTop:10}},e('audio',{src:URL.createObjectURL(audioBlobs[type]),controls:true,style:{width:'100%',borderRadius:6}}),e('button',{type:'button',className:'nav-btn secondary',style:{marginTop:6,padding:'6px 12px',fontSize:11},onClick:()=>clearAudio(type)},'Remove'))),
e('div',{className:'sig-section'},e('h3',null,'‚úçÔ∏è Electronic Signature'),e('div',{className:'sig-canvas-wrap'},e('canvas',{ref:canvasRef,className:'sig-canvas',onMouseDown:ev=>startDraw(ev,ctxRef),onMouseMove:ev=>draw(ev,ctxRef),onMouseUp:()=>stopDraw(canvasRef,dataKey),onMouseLeave:()=>stopDraw(canvasRef,dataKey),onTouchStart:ev=>startDraw(ev,ctxRef),onTouchMove:ev=>draw(ev,ctxRef),onTouchEnd:()=>stopDraw(canvasRef,dataKey)})),e('div',{style:{marginTop:8}},e('button',{className:'nav-btn secondary',type:'button',style:{padding:'8px 16px'},onClick:()=>clearSig(canvasRef,ctxRef,dataKey)},'Clear')),e('div',{className:'form-group',style:{marginTop:12}},e('label',null,'Type Full Legal Name'),e('input',{className:'input-field',value:data.typedName||'',onChange:x=>setData('typedName',x.target.value),placeholder:'Full legal name'})),e('div',{className:'checkbox-group'},e('input',{type:'checkbox',checked:data.consent1||false,onChange:x=>setData('consent1',x.target.checked)}),e('label',null,type==='hipaa'?'I authorize the release of my protected health information.':'I certify this information is true and correct.')),e('div',{className:'checkbox-group'},e('input',{type:'checkbox',checked:data.consent2||false,onChange:x=>setData('consent2',x.target.checked)}),e('label',null,'I consent to sign electronically per the E-SIGN Act.')),!d[signedKey]&&e('button',{className:'nav-btn primary',style:{marginTop:12,padding:'10px 20px'},onClick:async()=>{if(!data.typedName){alert('Please type your name');return}if(!data.signature){alert('Please sign above');return}if(!data.consent1||!data.consent2){alert('Please check both boxes');return}const ok=await submitInlineStmt(type,data,data.signature,audioBlobs[type]);if(ok){u(signedKey,true);clearAudio(type);alert('‚úì Signed successfully!')}else alert('Error signing')}},'Sign & Save'),d[signedKey]&&e('div',{className:'link-badge',style:{marginTop:12}},'‚úì Signed and attached'))),
d[optKey]==='later'&&e('div',{style:{marginTop:20}},e('div',{className:'form-grid'},e('div',{className:'form-group'},e('label',null,'Name'),e('input',{className:'input-field',value:data.linkName||'',onChange:x=>setData('linkName',x.target.value)})),e('div',{className:'form-group'},e('label',null,'Email'),e('input',{type:'email',className:'input-field',value:data.linkEmail||'',onChange:x=>setData('linkEmail',x.target.value)})),e('div',{className:'form-group'},e('label',null,'Phone (optional)'),e('input',{className:'input-field',value:data.linkPhone||'',onChange:x=>setData('linkPhone',x.target.value)}))),!d[linkKey]&&e('button',{className:'nav-btn primary',style:{marginTop:12},onClick:async()=>{const link=await generateLink(type,data.linkName,data.linkEmail,data.linkPhone);if(link){u(linkKey,link);alert('‚úì Link generated and sent!')}else alert('Error generating link')}},'Generate & Send Link'),d[linkKey]&&e('div',null,e('div',{className:'link-badge',style:{marginTop:12}},'‚úì Link sent'),e('p',{style:{fontSize:11,color:'var(--tm)',marginTop:8,wordBreak:'break-all'}},d[linkKey]))),
d[optKey]==='skip'&&e('div',{className:'info-tip',style:{marginTop:20}},'This can be collected after claim submission.'))};

const renderStep=()=>{
if(step===0)return e('div',{className:'content'},e('div',{className:'section-header'},e('h2',null,'Employee Information')),e('div',{className:'form-grid'},e('div',{className:'form-group'},e('label',null,'First Name ',e('span',{className:'required'},'*')),inp('firstName','First name')),e('div',{className:'form-group'},e('label',null,'Last Name ',e('span',{className:'required'},'*')),inp('lastName','Last name')),e('div',{className:'form-group full-width'},e('label',null,'Address'),inp('mailingAddress','Street')),e('div',{className:'form-group'},e('label',null,'City'),inp('city','City')),e('div',{className:'form-group'},e('label',null,'State'),sel('state',STATES,'State')),e('div',{className:'form-group'},e('label',null,'Zip'),inp('zipCode','Zip')),e('div',{className:'form-group'},e('label',null,'Phone'),inp('phone','Phone','tel')),e('div',{className:'form-group'},e('label',null,'DOB'),inp('dateOfBirth','','date')),e('div',{className:'form-group'},e('label',null,'Date of Hire'),inp('dateOfHire','','date')),e('div',{className:'form-group'},e('label',null,'SSN'),inp('ssn','XXX-XX-XXXX')),e('div',{className:'form-group'},e('label',null,'Occupation ',e('span',{className:'required'},'*')),inp('occupation','Job title'))));
if(step===1)return e('div',{className:'content'},e('div',{className:'section-header'},e('h2',null,'Claim Information')),e('div',{className:'form-group full-width'},e('label',null,'Entity ',e('span',{className:'required'},'*')),sel('entity',[...entities,'Other - Enter Manually'],'Select Entity'),d.entity==='Other - Enter Manually'&&e('input',{className:'input-field',style:{marginTop:8},value:d.customEntity||'',onChange:x=>u('customEntity',x.target.value),placeholder:'Enter entity name'})),e('div',{className:'form-grid',style:{marginTop:16}},e('div',{className:'form-group'},e('label',null,'Date of Injury ',e('span',{className:'required'},'*')),inp('dateOfInjury','','date')),e('div',{className:'form-group'},e('label',null,'Time'),inp('timeOfInjury','','time')),e('div',{className:'form-group'},e('label',null,'Date Reported'),inp('dateReported','','date')),e('div',{className:'form-group'},e('label',null,'Reported Immediately?'),tog('reportedImmediately',[{v:true,l:'Yes'},{v:false,l:'No',c:'warning'}]))));
if(step===2)return e('div',{className:'content'},e('div',{className:'section-header'},e('h2',null,'Incident Details')),e('div',{className:'form-group full-width'},e('label',null,'Description ',e('span',{className:'required'},'*')),e('textarea',{className:'input-field',rows:4,value:d.accidentDescription||'',onChange:x=>u('accidentDescription',x.target.value),placeholder:'Who, what, when, where, how...'})),e('div',{className:'form-group full-width',style:{marginTop:16}},e('label',null,'Injury Type ',e('span',{className:'required'},'*')),e('div',{className:'injury-grid'},...INJURY_TYPES.map(t=>e('button',{key:t.v,type:'button',className:'injury-btn'+(d.injuryType===t.v?' active':''),onClick:()=>u('injuryType',t.v)},e('span',{className:'injury-icon'},t.i),e('span',{className:'injury-label'},t.l))))),e('div',{className:'form-group full-width',style:{marginTop:16}},e('label',null,'Body Parts'),e('div',{style:{display:'flex',flexWrap:'wrap',gap:8}},...BODY_PARTS.map(p=>e('button',{key:p,type:'button',className:'chip-btn'+(d.bodyParts?.includes(p)?' active':''),onClick:()=>ta('bodyParts',p)},p)))));
if(step===3)return e('div',{className:'content'},e('div',{className:'section-header'},e('h2',null,'Medical Treatment')),e('div',{className:'form-group'},e('label',null,'Has employee received medical treatment?'),tog('soughtMedicalTreatment',[{v:true,l:'Yes'},{v:false,l:'No'}])),d.soughtMedicalTreatment===true&&e('div',{className:'form-group',style:{marginTop:16}},e('label',null,'Facility Name'),inp('initialFacilityName','Hospital/Clinic name')));
if(step===4)return e('div',{className:'content'},e('div',{className:'section-header'},e('h2',null,'Witnesses & Evidence')),e('div',{className:'form-group'},e('label',null,'Video Available?'),tog('hasVideo',[{v:true,l:'Yes',c:'success'},{v:false,l:'No'}]),d.hasVideo===true&&e('div',{className:'info-tip'},'‚ö° Preserve immediately! Systems auto-delete in 7-30 days.')),e('div',{className:'witness-card'},e('div',{className:'witness-header'},'Witness #1'),e('div',{className:'form-grid'},e('div',{className:'form-group'},inp('witness1Name','Name')),e('div',{className:'form-group'},inp('witness1Phone','Phone')))),e('div',{className:'witness-card'},e('div',{className:'witness-header'},'Witness #2'),e('div',{className:'form-grid'},e('div',{className:'form-group'},inp('witness2Name','Name')),e('div',{className:'form-group'},inp('witness2Phone','Phone')))),e('div',{style:{marginTop:20}},e('div',{className:'form-grid'},e('div',{className:'form-group'},e('label',null,'Witness Statement?'),tog('hasWitnessStatement',[{v:true,l:'Yes',c:'success'},{v:false,l:'No'},{v:'pending',l:'Pending'}])),e('div',{className:'form-group'},e('label',null,'Employee Statement?'),tog('hasEmployeeStatement',[{v:true,l:'Yes',c:'success'},{v:false,l:'No'},{v:'pending',l:'Pending'}])))));
if(step===5)return e('div',{className:'content'},e('div',{className:'section-header'},e('h2',null,'Work Status')),e('div',{className:'form-grid'},e('div',{className:'form-group'},e('label',null,'Losing Time?'),tog('losingTime',[{v:true,l:'Yes',c:'warning'},{v:false,l:'No',c:'success'}])),e('div',{className:'form-group'},e('label',null,'Date Last Worked'),inp('dateLastWorked','','date')),e('div',{className:'form-group'},e('label',null,'Return Status'),sel('returnStatus',['Has not returned','Full Duty','Light Duty'],'Select')),e('div',{className:'form-group'},e('label',null,'Light Duty Available?'),tog('lightDutyAvailable',[{v:true,l:'Yes',c:'success'},{v:false,l:'No',c:'warning'}]))));
if(step===6)return e('div',{className:'content'},e('div',{className:'section-header'},e('h2',null,'Root Cause Analysis')),e('div',{className:'form-group full-width'},e('label',null,'Direct Cause'),e('textarea',{className:'input-field',rows:2,value:d.directCause||'',onChange:x=>u('directCause',x.target.value),placeholder:'What directly caused the injury?'})),e('div',{className:'form-group full-width',style:{marginTop:16}},e('label',null,'Root Causes'),e('div',{style:{display:'flex',flexWrap:'wrap',gap:8}},...ROOT_CAUSES.map(c=>e('button',{key:c.v,type:'button',className:'chip-btn'+(d.rootCauseSymptoms?.includes(c.v)?' active warning':''),onClick:()=>ta('rootCauseSymptoms',c.v)},c.l)))),e('div',{style:{marginTop:24,paddingTop:20,borderTop:'1px solid var(--gbd)'}},e('h3',{style:{fontSize:14,color:'var(--ta)',marginBottom:16}},'Corrective Actions'),e('div',{style:{display:'flex',flexWrap:'wrap',gap:8}},...CORRECTIVE.map(c=>e('button',{key:c.v,type:'button',className:'chip-btn'+(d.correctiveActions?.includes(c.v)?' active success':''),onClick:()=>ta('correctiveActions',c.v)},c.l)))));
if(step===7)return e('div',{className:'content'},e('div',{className:'section-header'},e('h2',null,'Investigation Flags')),e('div',{className:'warning-box'},'‚ö†Ô∏è Red flags for closer review, not accusations.'),e('div',{className:'form-group'},e('label',null,'Validity Concerns?'),tog('validityConcerns',[{v:true,l:'Yes',c:'warning'},{v:false,l:'No'}])),d.validityConcerns===true&&e('div',{className:'form-group',style:{marginTop:12}},e('textarea',{className:'input-field',rows:2,value:d.concernDetails||'',onChange:x=>u('concernDetails',x.target.value),placeholder:'Explain concerns...'})),e('div',{className:'form-group full-width',style:{marginTop:20}},e('label',null,'Red Flag Indicators'),e('div',{style:{display:'flex',flexWrap:'wrap',gap:8}},...FRAUD.map(f=>e('button',{key:f.v,type:'button',className:'chip-btn'+(d.fraudIndicators?.includes(f.v)?' active danger':''),onClick:()=>ta('fraudIndicators',f.v)},f.l)))),e('div',{style:{marginTop:20,paddingTop:20,borderTop:'1px solid var(--gbd)'}},e('div',{className:'form-group'},e('label',null,'Third Party Involved? (Subrogation)'),tog('thirdPartyInvolved',[{v:true,l:'Yes',c:'success'},{v:false,l:'No'},{v:'maybe',l:'Maybe'}])),(d.thirdPartyInvolved===true||d.thirdPartyInvolved==='maybe')&&e('div',null,e('div',{className:'info-tip'},'üí∞ Subrogation potential! Preserve evidence.'),e('input',{className:'input-field',style:{marginTop:8},value:d.thirdPartyDetails||'',onChange:x=>u('thirdPartyDetails',x.target.value),placeholder:'Third party details...'}))));
if(step===8)return renderStatementStep('witness','Witness Statement','Collect a signed witness statement',wCanvasRef,wCtxRef,'witnessData','witnessOpt','witnessLink','witnessSigned');
if(step===9)return renderStatementStep('claimant','Claimant Statement','Collect the injured worker\'s signed statement',cCanvasRef,cCtxRef,'claimantData','claimantOpt','claimantLink','claimantSigned');
if(step===10)return renderStatementStep('hipaa','HIPAA Authorization','Collect signed HIPAA release for medical records',hCanvasRef,hCtxRef,'hipaaData','hipaaOpt','hipaaLink','hipaaSigned');
if(step===11)return e('div',{className:'content'},e('div',{className:'section-header'},e('h2',null,'Submit Claim'),lastSaved&&e('p',{style:{fontSize:11,color:'var(--tg)'}},'‚úì Draft auto-saved at '+lastSaved)),e('div',{style:{textAlign:'center',margin:'20px 0'}},e('div',{style:{display:'inline-block',width:80,height:80,borderRadius:'50%',background:'conic-gradient(var(--tg) '+score+'%, rgba(139,148,158,0.2) '+score+'%)',position:'relative'}},e('div',{style:{position:'absolute',top:8,left:8,width:64,height:64,background:'var(--td)',borderRadius:'50%',display:'flex',alignItems:'center',justifyContent:'center'}},e('span',{style:{fontSize:24,fontWeight:'bold',color:'var(--tg)'}},score+'%')))),inlineStmts.length>0&&e('div',{className:'info-tip',style:{background:'rgba(52,211,153,0.1)',borderColor:'var(--tg)'}},'‚úì '+inlineStmts.length+' e-signed document(s) will be attached'),e('div',{className:'summary-grid'},e('div',{className:'summary-section'},e('h4',null,'Employee'),e('p',null,(d.firstName||'‚Äî')+' '+(d.lastName||'')),e('p',null,d.occupation||'‚Äî')),e('div',{className:'summary-section'},e('h4',null,'Claim'),e('p',null,d.entity==='Other - Enter Manually'?d.customEntity||'‚Äî':d.entity||'‚Äî'),e('p',null,d.dateOfInjury||'‚Äî'))),e('div',{style:{marginTop:20,padding:16,background:'rgba(30,42,56,0.6)',borderRadius:10,border:'1px solid var(--gbd)'}},e('h3',{style:{color:'var(--ta)',fontSize:14,marginBottom:12}},'üìé Upload Documents'),e('input',{type:'file',multiple:true,accept:'image/*,.pdf,.doc,.docx',onChange:x=>setUploadedFiles(Array.from(x.target.files)),style:{display:'none'},id:'file-upload'}),e('label',{htmlFor:'file-upload',className:'nav-btn secondary',style:{display:'inline-block',cursor:'pointer'}},'Choose Files'),uploadedFiles.length>0&&e('p',{style:{fontSize:12,color:'var(--tg)',marginTop:8}},'‚úì '+uploadedFiles.length+' file(s) selected')),e('div',{className:'form-grid',style:{marginTop:20}},e('div',{className:'form-group'},e('label',null,'Your Name ',e('span',{className:'required'},'*')),inp('submitterName','Your name')),e('div',{className:'form-group'},e('label',null,'Your Email ',e('span',{className:'required'},'*')),inp('submitterEmail','email@company.com','email'))),e('div',{style:{marginTop:20,padding:16,background:'rgba(30,42,56,0.6)',borderRadius:10,border:'1px solid var(--gbd)',textAlign:'center'}},e('p',{style:{color:'var(--tm)'}},'THE ABOVE REPORT IS TRUE AND CORRECT.')));
};

return e('div',{className:'portal'},e('header',{className:'header'},e('div',{className:'header-content'},e('div',{className:'brand'},e('div',{className:'brand-logo'},e('svg',{viewBox:'0 0 40 44'},e('path',{d:'M20 0L0 10v14c0 11 8.5 18.5 20 20 11.5-1.5 20-9 20-20V10L20 0zm0 4l16 8v12c0 8.8-6.8 14.8-16 16-9.2-1.2-16-7.2-16-16V12l16-8z'}))),e('div',{className:'brand-text'},e('h1',null,'TITANIUM'),e('p',null,'DEFENSE GROUP'))),e('div',{className:'completion-badge'},e('div',{className:'completion-bar'},e('div',{className:'completion-fill',style:{width:score+'%'}})),e('span',{className:'completion-text'},score+'%'),lastSaved&&e('span',{style:{marginLeft:8,fontSize:10,color:'var(--tg)'}},'‚úì Saved')))),e('div',{className:'body'},e('aside',{className:'sidebar'},e('div',{className:'steps'},...steps.map((s,i)=>e('div',{key:i,className:'step'+(i===step?' active':''),onClick:()=>setStep(i)},e('div',{className:'step-icon'},s.i),e('span',null,s.t))))),e('main',{className:'main'},renderStep(),e('div',{className:'nav'},e('button',{className:'nav-btn secondary',onClick:()=>setStep(Math.max(0,step-1)),disabled:step===0},'‚Üê Back'),step<11?e('button',{className:'nav-btn primary',onClick:()=>setStep(step+1)},'Continue ‚Üí'):e('button',{className:'nav-btn primary',disabled:submitting,onClick:submit},submitting?'Submitting...':'Submit Claim')))));
}
ReactDOM.createRoot(document.getElementById('root')).render(e(App));
</script>
</body>
</html>
